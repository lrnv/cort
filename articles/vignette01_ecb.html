<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>1. Empirical Checkerboard Copula • cort</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="1. Empirical Checkerboard Copula">
<meta property="og:description" content="cort">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cort</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignette01_ecb.html">1. Empirical Checkerboard Copula</a>
    </li>
    <li>
      <a href="../articles/vignette02_cort_clayton.html">2. The Copula Recursive Tree</a>
    </li>
    <li>
      <a href="../articles/vignette03_ecbkm.html">3. Empirical Checkerboard Copula with known margins</a>
    </li>
    <li>
      <a href="../articles/vignette04_bootstrap_varying_m.html">4. Convex mixture of m-randomized checkerboards</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lrnv/cort/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="vignette01_ecb_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>1. Empirical Checkerboard Copula</h1>
                        <h4 class="author">Oskar Laverny</h4>
            
            <h4 class="date">2021-03-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lrnv/cort/blob/master/vignettes/vignette01_ecb.Rmd"><code>vignettes/vignette01_ecb.Rmd</code></a></small>
      <div class="hidden name"><code>vignette01_ecb.Rmd</code></div>

    </div>

    
    
<p>The empirical checkerboard copula is a model for copula defined by <span class="citation">(Cuberos, Masiello, and Maume-Deschamps 2019)</span>. It provides a fast and easy way to model a copula in high-dimensional settings (more columns than rows in the dataset). It only requires one parameter, <span class="math inline">\(m\)</span>, the so-called checkerboard parameter. In the first section of this vignette, we will set notations and define the model. The second section will discuss and demonstrate the implementation made in the package.</p>
<div id="definition-of-the-empirical-checkerboard-copula" class="section level2">
<h2 class="hasAnchor">
<a href="#definition-of-the-empirical-checkerboard-copula" class="anchor"></a>Definition of the empirical checkerboard copula</h2>
<p>Suppose that we have a dataset with <span class="math inline">\(n\)</span> i.i.d observation of a <span class="math inline">\(d\)</span>-dimentional copula (or pseudo-observations). Take the checkerboard parameter <span class="math inline">\(m\)</span> to be an integer dividing <span class="math inline">\(n\)</span>.</p>
<p>Let’s consider the ensemble of multi-indexes <span class="math inline">\(\mathcal{I} = \{\mathbf{i} = (i_1,..,i_d) \subset \{1,...,m \}^d\}\)</span> which indexes the boxes :</p>
<p><span class="math display">\[B_{\mathbf{i}} = \left]\frac{\mathbf{i}-1}{m},\frac{\mathbf{i}}{m}\right]\]</span></p>
<p>partitioning the space <span class="math inline">\(\mathbb{I}^d = [0,1]^d\)</span>.</p>
<p>Let now <span class="math inline">\(\lambda\)</span> be the dimension-unspecific Lebesgue measure on any power of <span class="math inline">\(\mathbb{R}\)</span>, that is :</p>
<p><span class="math display">\[\forall d \in \mathbb{N}, \forall x,y \in \mathbb{R}^p, \lambda(\left[x,y\right]) = \prod\limits_{p=1}^{d} (y_i - x_i)\]</span></p>
<p>Let furthermore <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\hat{\mu}\)</span> be respectively the true copula measure of the sample at hand and the classical Deheuvels empirical copula, that is :</p>
<ul>
<li>For <span class="math inline">\(n\)</span> i.i.d observation of the copula of dimension <span class="math inline">\(d\)</span>, let <span class="math inline">\(\forall i \in \{1,...,d\}, \, R_i^1,...,R_i^d\)</span> be the marginal ranks for the variable <span class="math inline">\(i\)</span>.</li>
<li><span class="math inline">\(\forall x \in \mathcal{I}^d, \text{ let } \hat{\mu}([0,x]) = \frac{1}{n} \sum\limits_{k=1}^n \mathbb{1}_{R_1^k\le x_1,...,R_d^k\le x_d}\)</span></li>
</ul>
<p>We are now ready to define the checkerboard copula, <span class="math inline">\(C\)</span>, and the empirical checkerboard copula, <span class="math inline">\(\hat{C}\)</span>, by the following :</p>
<p><span class="math display">\[\forall x \in [0,1]^d, C(x) = \sum\limits_{\mathbf{i}\in\mathcal{I}} {m^d \mu(B_{\mathbf{i}}) \lambda([0,\mathbf{x}]\cap B_{\mathbf{i}})}\]</span></p>
<p>Where <span class="math inline">\(m^d = \lambda(B_{\mathbf{i}})\)</span>.</p>
<p>This copula is a special form of patchwork copulas (see Durante) and some results are known about it : it is indeed a copula, it converges to the true copula as the mesh (size of boxes) goes to zero, etc..</p>
<p>This package gives a comprehensive implementation of the empirical counterpart of this copula, which has exactly the same expression except that <span class="math inline">\(\mu\)</span>, the true copula of the sample, is replace by it’s Deheuvel approximation <span class="math inline">\(\hat{\mu}\)</span>, that is :</p>
<p><span class="math display">\[\forall x \in [0,1]^d, \hat{C}(x) = \sum\limits_{\mathbf{i}\in\mathcal{I}} {m^d \hat{\mu}(B_{\mathbf{i}}) \lambda([0,\mathbf{x}]\cap B_{\mathbf{i}})}\]</span></p>
<p>A known result is that this is a copula if and only if <span class="math inline">\(m\)</span> divides <span class="math inline">\(n\)</span> (see cuberos). In this case, some theoretical assymptotics are avaliables.</p>
<p>The next section discuss the implementation.</p>
</div>
<div id="implementation" class="section level2">
<h2 class="hasAnchor">
<a href="#implementation" class="anchor"></a>Implementation</h2>
<p>In this package, this empirical checkerboard copula is implemented in the <code>cbCopula</code> class. This class is a little more general as it allows for a vector <span class="math inline">\(m = (m_1,...,m_d)\)</span> instead of a single value. Each of the <span class="math inline">\(m_i\)</span>’s must divide <span class="math inline">\(n\)</span> for this to be a proper copula. With the same train of thoughts as before, we have the following expression for this model :</p>
<p><span class="math display">\[\forall x \in [0,1]^d, \hat{C}(x) = \sum\limits_{\mathbf{i}\in\mathcal{I}} { \hat{\mu}(B_{\mathbf{i}}) \lambda([0,\mathbf{x}]\cap B_{\mathbf{i}})\prod\limits_{p=1}^{d}m_p}\]</span></p>
<p>You need to provide a dataset, defining <span class="math inline">\(\hat{\mu}\)</span>, to construct the model. For the matter of this vignette, we will use the <code>LifeCycleSavings</code> dataset, which has following pairs dependencies plot :</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"LifeCycleSavings"</span><span class="op">)</span>
<span class="va">pseudo_data</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">LifeCycleSavings</span>,<span class="fl">2</span>,<span class="va">rank</span>,ties.method<span class="op">=</span><span class="st">"max"</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">LifeCycleSavings</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html">pairs</a></span><span class="op">(</span><span class="va">pseudo_data</span>,lower.panel<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="vignette01_ecb_files/figure-html/unnamed-chunk-1-1.png" alt="Pairs-plot of original peusdo-observation from the data" width="672"><p class="caption">
Pairs-plot of original peusdo-observation from the data
</p>
</div>
<p>You can see that the variable 2 to 4 have dependencies, while the first and fifth variable seems to be (marginally) independent. The dataset having <span class="math inline">\(n=50\)</span> rows, we will pick a value of <span class="math inline">\(m\)</span> dividing <span class="math inline">\(50\)</span>, e.g <span class="math inline">\(m=5\)</span>, and use the function <code>cbCopula</code> to build our copula model. Since we are already providing the pseudo observations, we will set <code>pseudo = TRUE</code>. Providing a single value for the <span class="math inline">\(m\)</span> parameter will set all <span class="math inline">\(m_i\)</span>’s equal to that value (the default is the proper checkerboard copula).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">cop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cbCopula-Class.html">cbCopula</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pseudo_data</span>,m <span class="op">=</span> <span class="fl">5</span>,pseudo <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; This is a cbCopula , with : </span>
<span class="co">#&gt;    dim = 5 </span>
<span class="co">#&gt;    n = 50 </span>
<span class="co">#&gt;    m = 5 5 5 5 5 </span>
<span class="co">#&gt; The variables names are :  sr pop15 pop75 dpi ddpi</span></code></pre></div>
<p>For the moment, only some methods exist for this copula. We can calculate it’s values via the <code>pCopula</code> method, or simulate from it via the <code>rCopula</code> method. the <code>dCopula</code> methods gives it’s density. Here is an example of simulation from this model :</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">simu</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rCopula.html">rCopula</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1000</span>,copula <span class="op">=</span> <span class="va">cop</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html">pairs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">simu</span>,<span class="va">pseudo_data</span><span class="op">)</span>,
      col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"black"</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">simu</span><span class="op">)</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"red"</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pseudo_data</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
      gap<span class="op">=</span><span class="fl">0</span>,
      lower.panel<span class="op">=</span><span class="cn">NULL</span>,cex<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="vignette01_ecb_files/figure-html/unnamed-chunk-3-1.png" alt="Pairs-plot of original peusdo-observation from the data (red) with simulated pseudo_observation (black)" width="672"><p class="caption">
Pairs-plot of original peusdo-observation from the data (red) with simulated pseudo_observation (black)
</p>
</div>
</div>
<div id="about-the-value-of-m" class="section level2">
<h2 class="hasAnchor">
<a href="#about-the-value-of-m" class="anchor"></a>About the value of <span class="math inline">\(m\)</span>
</h2>
<p>The value of the checkerboard parameter <span class="math inline">\(m\)</span> condition heavily the copula itself. See the vignette about convex mixtures of m-randomized checkerboards for more details.</p>
<div id="refs" class="references">
<div id="ref-cuberos2019">
<p>Cuberos, A., E. Masiello, and V. Maume-Deschamps. 2019. “Copulas Checker-Type Approximations: Application to Quantiles Estimation of Sums of Dependent Random Variables.” <em>Communications in Statistics - Theory and Methods</em>, March, 1–19.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Oskar Laverny.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
