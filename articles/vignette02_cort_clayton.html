<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2. The Copula Recursive Tree • cort</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="2. The Copula Recursive Tree">
<meta property="og:description" content="cort">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cort</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignette01_ecb.html">1. Empirical Checkerboard Copula</a>
    </li>
    <li>
      <a href="../articles/vignette02_cort_clayton.html">2. The Copula Recursive Tree</a>
    </li>
    <li>
      <a href="../articles/vignette03_ecbkm.html">3. Empirical Checkerboard Copula with known margins</a>
    </li>
    <li>
      <a href="../articles/vignette04_bootstrap_varying_m.html">4. Convex mixture of m-randomized checkerboards</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lrnv/cort/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>2. The Copula Recursive Tree</h1>
            
            <h4 data-toc-skip class="date">2022-05-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lrnv/cort/blob/HEAD/vignettes/vignette02_cort_clayton.Rmd" class="external-link"><code>vignettes/vignette02_cort_clayton.Rmd</code></a></small>
      <div class="hidden name"><code>vignette02_cort_clayton.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette, we will use the Cort algorithm to fit a copula on a given simulated dataset based on clayton copula simulations. We will show how the algorithm can be used to produce a bona-fide copula, and describe some of the parameters.</p>
</div>
<div class="section level2">
<h2 id="dataset">Dataset<a class="anchor" aria-label="anchor" href="#dataset"></a>
</h2>
<p>First, let’s create and plot the dataset we will work with. For that, we’ll use the gamma frailty model for the Clayton copula (but it’ll work for any other completely monotonous archimedean generator), as it is done in the <code>copula</code> package, see <a href="https://github.com/cran/copula/blob/6e0a5f0332776c24b2f53a81b11a8c66cc3f996d/R/claytonCopula.R#L82" class="external-link">there</a>. The following code is directly taken from the previous link, from the <code>copula</code> package :</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">psi</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>,<span class="va">alpha</span><span class="op">)</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/sign.html" class="external-link">sign</a></span><span class="op">(</span><span class="va">alpha</span><span class="op">)</span><span class="op">*</span><span class="va">t</span><span class="op">)</span> <span class="op">^</span> <span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="va">alpha</span><span class="op">)</span> <span class="co"># generator</span>
<span class="va">rClayton</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>,<span class="va">dim</span>,<span class="va">alpha</span><span class="op">)</span><span class="op">{</span>
  <span class="va">val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">dim</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">n</span><span class="op">)</span>
  <span class="va">gam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="va">n</span>, shape <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">alpha</span>, rate <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
  <span class="va">gam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">gam</span>, nrow <span class="op">=</span> <span class="va">n</span>, ncol <span class="op">=</span> <span class="va">dim</span><span class="op">)</span>
  <span class="fu">psi</span><span class="op">(</span><span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">val</span><span class="op">)</span> <span class="op">/</span> <span class="va">gam</span>,<span class="va">alpha</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The following code simulates a dataset and then visualise it :</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span>
<span class="va">n</span> <span class="op">=</span> <span class="fl">200</span> <span class="co"># taken small to reduce runtime of the vignette.</span>
<span class="va">d</span> <span class="op">=</span> <span class="fl">4</span>
<span class="va">n_trees</span> <span class="op">=</span> <span class="fl">5</span> <span class="co"># taken small to reduce runtime of the vignette.</span>
<span class="va">number_max_dim_forest</span> <span class="op">=</span> <span class="fl">2</span> <span class="co"># taken small to reduce runtime of the vignette.</span>

<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow<span class="op">=</span><span class="va">n</span>,ncol<span class="op">=</span><span class="va">d</span><span class="op">)</span>
<span class="va">data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span>,<span class="fl">3</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="fu">rClayton</span><span class="op">(</span>n<span class="op">=</span><span class="va">n</span>,dim<span class="op">=</span><span class="va">d</span><span class="op">-</span><span class="fl">1</span>,alpha<span class="op">=</span><span class="fl">7</span><span class="op">)</span>
<span class="va">data</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>
<span class="va">data</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">data</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html" class="external-link">pairs</a></span><span class="op">(</span><span class="va">data</span>,cex<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span></code></pre></div>
<p><img src="vignette02_cort_clayton_files/figure-html/dataset-1.png" width="672"></p>
<p>We can clearly see that the second marginal is independent form the rest. In the following we will use this package to fit this dependence structure.</p>
</div>
<div class="section level2">
<h2 id="fitting-the-cort-copula">Fitting the Cort copula<a class="anchor" aria-label="anchor" href="#fitting-the-cort-copula"></a>
</h2>
<p>Now that we have a dataset, we can run the Cort algorithm on it. In the implementation proposed here, this is done via the <code><a href="../reference/Cort-Class.html">cort::Cort()</a></code> function, passing first the dataset, and then various parameters. See <code><a href="../reference/Cort-Class.html">?Cort</a></code> for a detailed list of parameters. Note that the verbosity level is quite progressive: We will here put it on 4 to see the splitting decisions that the algorithm is making.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span>
<span class="op">(</span><span class="va">model</span> <span class="op">=</span> <span class="fu"><a href="../reference/Cort-Class.html">Cort</a></span><span class="op">(</span><span class="va">data</span>,verbose_lvl <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Splitting...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;      1 leaves to split...</span>
<span class="co">#&gt;      7 leaves to split...</span>
<span class="co">#&gt;      16 leaves to split...</span>
<span class="co">#&gt;      8 leaves to split...</span>
<span class="co">#&gt;      6 leaves to split...</span>
<span class="co">#&gt;      4 leaves to split...</span>
<span class="co">#&gt;      7 leaves to split...</span>
<span class="co">#&gt;      9 leaves to split...</span>
<span class="co">#&gt;      13 leaves to split...</span>
<span class="co">#&gt;      18 leaves to split...</span>
<span class="co">#&gt;      2 leaves to split...</span>
<span class="co">#&gt; Enforcing constraints...</span>
<span class="co">#&gt; Done !</span>
<span class="co">#&gt; Cort copula model: 200x4-dataset and 357 leaves.</span></code></pre></div>
<p>Looking at the top of the output, we see that the first thing the algorithm did was removing the second dimension due to the independence test. Now that the copula is fitted, we have access to numerous of it’s methods. Two plotting functions are exported with this model, the <code>pairs</code> function is implemented at a very low level in the class hierarchy and hence is working with almost all copulas of this package, but the <code>plot</code> function is only implemented for Cort.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/pairs.html" class="external-link">pairs</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="vignette02_cort_clayton_files/figure-html/unnamed-chunk-1-1.png" alt="Pairs-plot of original data (in black, bottom-left corner) versus a simulation from the model (in red, top-right corner)" width="672"><p class="caption">
Pairs-plot of original data (in black, bottom-left corner) versus a simulation from the model (in red, top-right corner)
</p>
</div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="vignette02_cort_clayton_files/figure-html/unnamed-chunk-2-1.png" alt="Gray boxes representing 2-d projections of the fitted density. In red, the imputed data points." width="672"><p class="caption">
Gray boxes representing 2-d projections of the fitted density. In red, the imputed data points.
</p>
</div>
<p>We see that there are some noise with point were there should not be. A bagged version of the model is accessible via the <code>CortForest</code> class, and might be able to correct these problems.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Oskar Laverny.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
